{
  "id": "SPEED_OPTIMIZED_GUARDRAIL_TEST",
  "name": "Speed Optimized with Guardrail Test",
  "description": "[Critical Fix] SPEED_OPTIMIZED 전략에서 계정 동시성 제한(100) 초과 시 가드레일 작동 검증. 120개 브랜치로 실제 배치 분할 테스트.",
  "version": "2.0.0",
  "nodes": [
    {
      "id": "massive_setup",
      "type": "operator",
      "label": "대량 브랜치 설정",
      "config": {
        "language": "python",
        "code": "# 120개 브랜치 실행 시작 (ACCOUNT_LAMBDA_CONCURRENCY_LIMIT=100 초과)\nstate['total_branches'] = 120\nstate['concurrency_limit'] = 100\nstate['expected_batches'] = 2  # 최소 2개 배치로 분할되어야 함\nstate['guardrail_test_started'] = True"
      }
    },
    {
      "id": "speed_parallel_group",
      "type": "parallel_group",
      "label": "SPEED 모드 120개 병렬 브랜치 (가드레일 발동 임계값 초과)",
      "resource_policy": {
        "strategy": "SPEED_OPTIMIZED"
      },
      "branches": [
        {"id": "b1", "nodes": [{"id": "n1", "type": "operator", "config": {"language": "python", "code": "state['r1']=1"}}], "edges": []},
        {"id": "b2", "nodes": [{"id": "n2", "type": "operator", "config": {"language": "python", "code": "state['r2']=1"}}], "edges": []},
        {"id": "b3", "nodes": [{"id": "n3", "type": "operator", "config": {"language": "python", "code": "state['r3']=1"}}], "edges": []},
        {"id": "b4", "nodes": [{"id": "n4", "type": "operator", "config": {"language": "python", "code": "state['r4']=1"}}], "edges": []},
        {"id": "b5", "nodes": [{"id": "n5", "type": "operator", "config": {"language": "python", "code": "state['r5']=1"}}], "edges": []},
        {"id": "b6", "nodes": [{"id": "n6", "type": "operator", "config": {"language": "python", "code": "state['r6']=1"}}], "edges": []},
        {"id": "b7", "nodes": [{"id": "n7", "type": "operator", "config": {"language": "python", "code": "state['r7']=1"}}], "edges": []},
        {"id": "b8", "nodes": [{"id": "n8", "type": "operator", "config": {"language": "python", "code": "state['r8']=1"}}], "edges": []},
        {"id": "b9", "nodes": [{"id": "n9", "type": "operator", "config": {"language": "python", "code": "state['r9']=1"}}], "edges": []},
        {"id": "b10", "nodes": [{"id": "n10", "type": "operator", "config": {"language": "python", "code": "state['r10']=1"}}], "edges": []},
        {"id": "b11", "nodes": [{"id": "n11", "type": "operator", "config": {"language": "python", "code": "state['r11']=1"}}], "edges": []},
        {"id": "b12", "nodes": [{"id": "n12", "type": "operator", "config": {"language": "python", "code": "state['r12']=1"}}], "edges": []},
        {"id": "b13", "nodes": [{"id": "n13", "type": "operator", "config": {"language": "python", "code": "state['r13']=1"}}], "edges": []},
        {"id": "b14", "nodes": [{"id": "n14", "type": "operator", "config": {"language": "python", "code": "state['r14']=1"}}], "edges": []},
        {"id": "b15", "nodes": [{"id": "n15", "type": "operator", "config": {"language": "python", "code": "state['r15']=1"}}], "edges": []},
        {"id": "b16", "nodes": [{"id": "n16", "type": "operator", "config": {"language": "python", "code": "state['r16']=1"}}], "edges": []},
        {"id": "b17", "nodes": [{"id": "n17", "type": "operator", "config": {"language": "python", "code": "state['r17']=1"}}], "edges": []},
        {"id": "b18", "nodes": [{"id": "n18", "type": "operator", "config": {"language": "python", "code": "state['r18']=1"}}], "edges": []},
        {"id": "b19", "nodes": [{"id": "n19", "type": "operator", "config": {"language": "python", "code": "state['r19']=1"}}], "edges": []},
        {"id": "b20", "nodes": [{"id": "n20", "type": "operator", "config": {"language": "python", "code": "state['r20']=1"}}], "edges": []},
        {"id": "b21", "nodes": [{"id": "n21", "type": "operator", "config": {"language": "python", "code": "state['r21']=1"}}], "edges": []},
        {"id": "b22", "nodes": [{"id": "n22", "type": "operator", "config": {"language": "python", "code": "state['r22']=1"}}], "edges": []},
        {"id": "b23", "nodes": [{"id": "n23", "type": "operator", "config": {"language": "python", "code": "state['r23']=1"}}], "edges": []},
        {"id": "b24", "nodes": [{"id": "n24", "type": "operator", "config": {"language": "python", "code": "state['r24']=1"}}], "edges": []},
        {"id": "b25", "nodes": [{"id": "n25", "type": "operator", "config": {"language": "python", "code": "state['r25']=1"}}], "edges": []},
        {"id": "b26", "nodes": [{"id": "n26", "type": "operator", "config": {"language": "python", "code": "state['r26']=1"}}], "edges": []},
        {"id": "b27", "nodes": [{"id": "n27", "type": "operator", "config": {"language": "python", "code": "state['r27']=1"}}], "edges": []},
        {"id": "b28", "nodes": [{"id": "n28", "type": "operator", "config": {"language": "python", "code": "state['r28']=1"}}], "edges": []},
        {"id": "b29", "nodes": [{"id": "n29", "type": "operator", "config": {"language": "python", "code": "state['r29']=1"}}], "edges": []},
        {"id": "b30", "nodes": [{"id": "n30", "type": "operator", "config": {"language": "python", "code": "state['r30']=1"}}], "edges": []},
        {"id": "b31", "nodes": [{"id": "n31", "type": "operator", "config": {"language": "python", "code": "state['r31']=1"}}], "edges": []},
        {"id": "b32", "nodes": [{"id": "n32", "type": "operator", "config": {"language": "python", "code": "state['r32']=1"}}], "edges": []},
        {"id": "b33", "nodes": [{"id": "n33", "type": "operator", "config": {"language": "python", "code": "state['r33']=1"}}], "edges": []},
        {"id": "b34", "nodes": [{"id": "n34", "type": "operator", "config": {"language": "python", "code": "state['r34']=1"}}], "edges": []},
        {"id": "b35", "nodes": [{"id": "n35", "type": "operator", "config": {"language": "python", "code": "state['r35']=1"}}], "edges": []},
        {"id": "b36", "nodes": [{"id": "n36", "type": "operator", "config": {"language": "python", "code": "state['r36']=1"}}], "edges": []},
        {"id": "b37", "nodes": [{"id": "n37", "type": "operator", "config": {"language": "python", "code": "state['r37']=1"}}], "edges": []},
        {"id": "b38", "nodes": [{"id": "n38", "type": "operator", "config": {"language": "python", "code": "state['r38']=1"}}], "edges": []},
        {"id": "b39", "nodes": [{"id": "n39", "type": "operator", "config": {"language": "python", "code": "state['r39']=1"}}], "edges": []},
        {"id": "b40", "nodes": [{"id": "n40", "type": "operator", "config": {"language": "python", "code": "state['r40']=1"}}], "edges": []},
        {"id": "b41", "nodes": [{"id": "n41", "type": "operator", "config": {"language": "python", "code": "state['r41']=1"}}], "edges": []},
        {"id": "b42", "nodes": [{"id": "n42", "type": "operator", "config": {"language": "python", "code": "state['r42']=1"}}], "edges": []},
        {"id": "b43", "nodes": [{"id": "n43", "type": "operator", "config": {"language": "python", "code": "state['r43']=1"}}], "edges": []},
        {"id": "b44", "nodes": [{"id": "n44", "type": "operator", "config": {"language": "python", "code": "state['r44']=1"}}], "edges": []},
        {"id": "b45", "nodes": [{"id": "n45", "type": "operator", "config": {"language": "python", "code": "state['r45']=1"}}], "edges": []},
        {"id": "b46", "nodes": [{"id": "n46", "type": "operator", "config": {"language": "python", "code": "state['r46']=1"}}], "edges": []},
        {"id": "b47", "nodes": [{"id": "n47", "type": "operator", "config": {"language": "python", "code": "state['r47']=1"}}], "edges": []},
        {"id": "b48", "nodes": [{"id": "n48", "type": "operator", "config": {"language": "python", "code": "state['r48']=1"}}], "edges": []},
        {"id": "b49", "nodes": [{"id": "n49", "type": "operator", "config": {"language": "python", "code": "state['r49']=1"}}], "edges": []},
        {"id": "b50", "nodes": [{"id": "n50", "type": "operator", "config": {"language": "python", "code": "state['r50']=1"}}], "edges": []},
        {"id": "b51", "nodes": [{"id": "n51", "type": "operator", "config": {"language": "python", "code": "state['r51']=1"}}], "edges": []},
        {"id": "b52", "nodes": [{"id": "n52", "type": "operator", "config": {"language": "python", "code": "state['r52']=1"}}], "edges": []},
        {"id": "b53", "nodes": [{"id": "n53", "type": "operator", "config": {"language": "python", "code": "state['r53']=1"}}], "edges": []},
        {"id": "b54", "nodes": [{"id": "n54", "type": "operator", "config": {"language": "python", "code": "state['r54']=1"}}], "edges": []},
        {"id": "b55", "nodes": [{"id": "n55", "type": "operator", "config": {"language": "python", "code": "state['r55']=1"}}], "edges": []},
        {"id": "b56", "nodes": [{"id": "n56", "type": "operator", "config": {"language": "python", "code": "state['r56']=1"}}], "edges": []},
        {"id": "b57", "nodes": [{"id": "n57", "type": "operator", "config": {"language": "python", "code": "state['r57']=1"}}], "edges": []},
        {"id": "b58", "nodes": [{"id": "n58", "type": "operator", "config": {"language": "python", "code": "state['r58']=1"}}], "edges": []},
        {"id": "b59", "nodes": [{"id": "n59", "type": "operator", "config": {"language": "python", "code": "state['r59']=1"}}], "edges": []},
        {"id": "b60", "nodes": [{"id": "n60", "type": "operator", "config": {"language": "python", "code": "state['r60']=1"}}], "edges": []},
        {"id": "b61", "nodes": [{"id": "n61", "type": "operator", "config": {"language": "python", "code": "state['r61']=1"}}], "edges": []},
        {"id": "b62", "nodes": [{"id": "n62", "type": "operator", "config": {"language": "python", "code": "state['r62']=1"}}], "edges": []},
        {"id": "b63", "nodes": [{"id": "n63", "type": "operator", "config": {"language": "python", "code": "state['r63']=1"}}], "edges": []},
        {"id": "b64", "nodes": [{"id": "n64", "type": "operator", "config": {"language": "python", "code": "state['r64']=1"}}], "edges": []},
        {"id": "b65", "nodes": [{"id": "n65", "type": "operator", "config": {"language": "python", "code": "state['r65']=1"}}], "edges": []},
        {"id": "b66", "nodes": [{"id": "n66", "type": "operator", "config": {"language": "python", "code": "state['r66']=1"}}], "edges": []},
        {"id": "b67", "nodes": [{"id": "n67", "type": "operator", "config": {"language": "python", "code": "state['r67']=1"}}], "edges": []},
        {"id": "b68", "nodes": [{"id": "n68", "type": "operator", "config": {"language": "python", "code": "state['r68']=1"}}], "edges": []},
        {"id": "b69", "nodes": [{"id": "n69", "type": "operator", "config": {"language": "python", "code": "state['r69']=1"}}], "edges": []},
        {"id": "b70", "nodes": [{"id": "n70", "type": "operator", "config": {"language": "python", "code": "state['r70']=1"}}], "edges": []},
        {"id": "b71", "nodes": [{"id": "n71", "type": "operator", "config": {"language": "python", "code": "state['r71']=1"}}], "edges": []},
        {"id": "b72", "nodes": [{"id": "n72", "type": "operator", "config": {"language": "python", "code": "state['r72']=1"}}], "edges": []},
        {"id": "b73", "nodes": [{"id": "n73", "type": "operator", "config": {"language": "python", "code": "state['r73']=1"}}], "edges": []},
        {"id": "b74", "nodes": [{"id": "n74", "type": "operator", "config": {"language": "python", "code": "state['r74']=1"}}], "edges": []},
        {"id": "b75", "nodes": [{"id": "n75", "type": "operator", "config": {"language": "python", "code": "state['r75']=1"}}], "edges": []},
        {"id": "b76", "nodes": [{"id": "n76", "type": "operator", "config": {"language": "python", "code": "state['r76']=1"}}], "edges": []},
        {"id": "b77", "nodes": [{"id": "n77", "type": "operator", "config": {"language": "python", "code": "state['r77']=1"}}], "edges": []},
        {"id": "b78", "nodes": [{"id": "n78", "type": "operator", "config": {"language": "python", "code": "state['r78']=1"}}], "edges": []},
        {"id": "b79", "nodes": [{"id": "n79", "type": "operator", "config": {"language": "python", "code": "state['r79']=1"}}], "edges": []},
        {"id": "b80", "nodes": [{"id": "n80", "type": "operator", "config": {"language": "python", "code": "state['r80']=1"}}], "edges": []},
        {"id": "b81", "nodes": [{"id": "n81", "type": "operator", "config": {"language": "python", "code": "state['r81']=1"}}], "edges": []},
        {"id": "b82", "nodes": [{"id": "n82", "type": "operator", "config": {"language": "python", "code": "state['r82']=1"}}], "edges": []},
        {"id": "b83", "nodes": [{"id": "n83", "type": "operator", "config": {"language": "python", "code": "state['r83']=1"}}], "edges": []},
        {"id": "b84", "nodes": [{"id": "n84", "type": "operator", "config": {"language": "python", "code": "state['r84']=1"}}], "edges": []},
        {"id": "b85", "nodes": [{"id": "n85", "type": "operator", "config": {"language": "python", "code": "state['r85']=1"}}], "edges": []},
        {"id": "b86", "nodes": [{"id": "n86", "type": "operator", "config": {"language": "python", "code": "state['r86']=1"}}], "edges": []},
        {"id": "b87", "nodes": [{"id": "n87", "type": "operator", "config": {"language": "python", "code": "state['r87']=1"}}], "edges": []},
        {"id": "b88", "nodes": [{"id": "n88", "type": "operator", "config": {"language": "python", "code": "state['r88']=1"}}], "edges": []},
        {"id": "b89", "nodes": [{"id": "n89", "type": "operator", "config": {"language": "python", "code": "state['r89']=1"}}], "edges": []},
        {"id": "b90", "nodes": [{"id": "n90", "type": "operator", "config": {"language": "python", "code": "state['r90']=1"}}], "edges": []},
        {"id": "b91", "nodes": [{"id": "n91", "type": "operator", "config": {"language": "python", "code": "state['r91']=1"}}], "edges": []},
        {"id": "b92", "nodes": [{"id": "n92", "type": "operator", "config": {"language": "python", "code": "state['r92']=1"}}], "edges": []},
        {"id": "b93", "nodes": [{"id": "n93", "type": "operator", "config": {"language": "python", "code": "state['r93']=1"}}], "edges": []},
        {"id": "b94", "nodes": [{"id": "n94", "type": "operator", "config": {"language": "python", "code": "state['r94']=1"}}], "edges": []},
        {"id": "b95", "nodes": [{"id": "n95", "type": "operator", "config": {"language": "python", "code": "state['r95']=1"}}], "edges": []},
        {"id": "b96", "nodes": [{"id": "n96", "type": "operator", "config": {"language": "python", "code": "state['r96']=1"}}], "edges": []},
        {"id": "b97", "nodes": [{"id": "n97", "type": "operator", "config": {"language": "python", "code": "state['r97']=1"}}], "edges": []},
        {"id": "b98", "nodes": [{"id": "n98", "type": "operator", "config": {"language": "python", "code": "state['r98']=1"}}], "edges": []},
        {"id": "b99", "nodes": [{"id": "n99", "type": "operator", "config": {"language": "python", "code": "state['r99']=1"}}], "edges": []},
        {"id": "b100", "nodes": [{"id": "n100", "type": "operator", "config": {"language": "python", "code": "state['r100']=1"}}], "edges": []},
        {"id": "b101", "nodes": [{"id": "n101", "type": "operator", "config": {"language": "python", "code": "state['r101']=1"}}], "edges": []},
        {"id": "b102", "nodes": [{"id": "n102", "type": "operator", "config": {"language": "python", "code": "state['r102']=1"}}], "edges": []},
        {"id": "b103", "nodes": [{"id": "n103", "type": "operator", "config": {"language": "python", "code": "state['r103']=1"}}], "edges": []},
        {"id": "b104", "nodes": [{"id": "n104", "type": "operator", "config": {"language": "python", "code": "state['r104']=1"}}], "edges": []},
        {"id": "b105", "nodes": [{"id": "n105", "type": "operator", "config": {"language": "python", "code": "state['r105']=1"}}], "edges": []},
        {"id": "b106", "nodes": [{"id": "n106", "type": "operator", "config": {"language": "python", "code": "state['r106']=1"}}], "edges": []},
        {"id": "b107", "nodes": [{"id": "n107", "type": "operator", "config": {"language": "python", "code": "state['r107']=1"}}], "edges": []},
        {"id": "b108", "nodes": [{"id": "n108", "type": "operator", "config": {"language": "python", "code": "state['r108']=1"}}], "edges": []},
        {"id": "b109", "nodes": [{"id": "n109", "type": "operator", "config": {"language": "python", "code": "state['r109']=1"}}], "edges": []},
        {"id": "b110", "nodes": [{"id": "n110", "type": "operator", "config": {"language": "python", "code": "state['r110']=1"}}], "edges": []},
        {"id": "b111", "nodes": [{"id": "n111", "type": "operator", "config": {"language": "python", "code": "state['r111']=1"}}], "edges": []},
        {"id": "b112", "nodes": [{"id": "n112", "type": "operator", "config": {"language": "python", "code": "state['r112']=1"}}], "edges": []},
        {"id": "b113", "nodes": [{"id": "n113", "type": "operator", "config": {"language": "python", "code": "state['r113']=1"}}], "edges": []},
        {"id": "b114", "nodes": [{"id": "n114", "type": "operator", "config": {"language": "python", "code": "state['r114']=1"}}], "edges": []},
        {"id": "b115", "nodes": [{"id": "n115", "type": "operator", "config": {"language": "python", "code": "state['r115']=1"}}], "edges": []},
        {"id": "b116", "nodes": [{"id": "n116", "type": "operator", "config": {"language": "python", "code": "state['r116']=1"}}], "edges": []},
        {"id": "b117", "nodes": [{"id": "n117", "type": "operator", "config": {"language": "python", "code": "state['r117']=1"}}], "edges": []},
        {"id": "b118", "nodes": [{"id": "n118", "type": "operator", "config": {"language": "python", "code": "state['r118']=1"}}], "edges": []},
        {"id": "b119", "nodes": [{"id": "n119", "type": "operator", "config": {"language": "python", "code": "state['r119']=1"}}], "edges": []},
        {"id": "b120", "nodes": [{"id": "n120", "type": "operator", "config": {"language": "python", "code": "state['r120']=1"}}], "edges": []}
      ]
    },
    {
      "id": "guardrail_verify",
      "type": "operator",
      "label": "가드레일 검증 - scheduling_metadata 직접 확인",
      "config": {
        "language": "python",
        "code": "# [Critical] 커널 scheduling_metadata 검증\nimport json\n\n# 히스토리에서 스케줄링 메타데이터 추출\nscheduling_meta = None\nfor log in state.get('__history', []):\n    if log.get('metadata', {}).get('scheduling_metadata'):\n        scheduling_meta = log['metadata']['scheduling_metadata']\n        break\n\nif not scheduling_meta:\n    # fallback: state에서 직접 확인\n    scheduling_meta = state.get('__scheduling_metadata', {})\n\n# Assert: 가드레일 작동 여부\nguardrail_applied = scheduling_meta.get('guardrail_applied', False)\nbatch_count = scheduling_meta.get('batch_count', 0)\ntotal_branches = scheduling_meta.get('total_branches', 0)\nstrategy = scheduling_meta.get('strategy', '')\n\n# TEST_RESULT 생성\nif guardrail_applied and batch_count >= 2 and total_branches == 120:\n    state['TEST_RESULT'] = f\"✅ GUARDRAIL SUCCESS: {total_branches} branches → {batch_count} batches (Strategy: {strategy})\"\n    state['guardrail_verified'] = True\n    state['test_passed'] = True\nelse:\n    state['TEST_RESULT'] = f\"❌ GUARDRAIL FAILED: guardrail_applied={guardrail_applied}, batch_count={batch_count}, total_branches={total_branches}\"\n    state['guardrail_verified'] = False\n    state['test_passed'] = False\n\n# 메타데이터 저장 (디버깅용)\nstate['scheduling_metadata_captured'] = json.dumps(scheduling_meta)\nstate['branch_count_expected'] = 120\nstate['batch_count_actual'] = batch_count"
      }
    }
  ],
  "edges": [
    {"source": "massive_setup", "target": "speed_parallel_group"},
    {"source": "speed_parallel_group", "target": "guardrail_verify"}
  ]
}
